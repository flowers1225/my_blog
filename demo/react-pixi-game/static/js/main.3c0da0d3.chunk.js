(this["webpackJsonpreact-pixijs-game"]=this["webpackJsonpreact-pixijs-game"]||[]).push([[0],{56:function(e,t,n){},67:function(e,t,n){},71:function(e,t,n){"use strict";n.r(t);var r,c=n(2),a=n.n(c),u=n(34),i=n.n(u),s=(n(56),n(7)),o=n(10),j=n(16),b=(n(67),n(35)),l={animalReducers:{count:0,isTouch:!1},startReducers:{isStart:!1,isGameOver:!1,isRestart:!1}},O=(r={animalReducers:function(e,t){switch(t.type){case"UPDATE_COUNT":return Object.assign({},e,{count:t.value});case"UPDATE_TOUCH":return Object.assign({},e,{isTouch:t.value});default:return e}},startReducers:function(e,t){switch(t.type){case"UPDATE_START":return Object.assign({},e,{isStart:!e.isStart});case"UPDATE_GAME_OVER":return Object.assign({},e,{isGameOver:!e.isGameOver});case"UPDATE_RESTART":return Object.assign({},e,{isRestart:!e.isRestart});default:return e}}},function(e,t){return Object.keys(r).map((function(n){return Object(b.a)({},n,r[n](e[n],t))})).reduce((function(e,t){return Object.assign({},e,t)}))}),d=Object(c.createContext)({}),f=n(9),h=function(e){var t=Object(c.useMemo)((function(){return[{align:"center",fontWeight:900,dropShadow:!0,dropShadowAlpha:.6,dropShadowAngle:1,dropShadowBlur:5,wordWrap:!0,fill:["#ff0000"]}]}),[]),n=Object(o.a)(t,1)[0],r=Object(c.useContext)(d),a=Object(o.a)(r,1)[0].animalReducers.count;return Object(c.useMemo)((function(){return Object(f.jsx)(j.Text,{text:"\u9003\u8dd1\u4e86\uff1a".concat(a),style:n,x:100,y:100})}),[a,n])},x=n(8),p=n(50),g=n(51),m=function(e){var t=e.resource,n=e.speed,r=e.run,a=e.size,u=e.startPos,i=Object(c.useState)([]),b=Object(o.a)(i,2),l=b[0],O=b[1],h=Object(c.useRef)(null),x=Object(c.useState)({x:0,y:0}),m=Object(o.a)(x,2),w=m[0],y=m[1],T=Object(c.useRef)({x:0,y:0}),v=Object(c.useState)(!1),S=Object(o.a)(v,2),R=S[0],E=S[1],C=Object(c.useState)(!1),A=Object(o.a)(C,2),M=A[0],U=A[1],k=Object(c.useRef)({width:150,height:150}),P=Object(c.useRef)(!0),D=Object(c.useContext)(d),F=Object(o.a)(D,2),_=F[0],z=_.animalReducers,G=_.startReducers,H=F[1],W=z.isTouch,B=z.count,L=G.isGameOver,N=G.isRestart,V=Object(c.useState)(!1),I=Object(o.a)(V,2),J=I[0],q=I[1],K=Object(c.useState)(!1),Q=Object(o.a)(K,2),X=Q[0],Y=Q[1],Z=Object(c.useState)(!1),$=Object(o.a)(Z,2),ee=$[0],te=$[1],ne=Object(c.useState)(!0),re=Object(o.a)(ne,2),ce=re[0],ae=re[1],ue=Object(c.useMemo)((function(){return[{x:a.width+u,y:a.height-180}]}),[a,u]),ie=Object(o.a)(ue,1)[0],se=Object(c.useMemo)((function(){return[{top:0,left:-k.current.width/2,right:a.width-k.current.width/2,bottom:ie.y}]}),[a,ie]),oe=Object(o.a)(se,1)[0],je=Object(g.useSpring)({},[]),be=Object(o.a)(je,2),le=be[0],Oe=be[1];Object(c.useEffect)((function(){O(t.run)}),[t]),Object(c.useEffect)((function(){y(Object(s.a)({},ie))}),[ie]),Object(c.useEffect)((function(){q(r),Y(r)}),[r]);var de=Object(c.useCallback)((function(){E(!1),U(!1),H({type:"UPDATE_TOUCH",value:!1}),y(Object(s.a)({},ie))}),[H]);Object(c.useEffect)((function(){h.current&&(de(),console.log("play"),h.current.play(),P.current=!0)}),[N,de]),Object(c.useEffect)((function(){h.current&&(L&&(console.log("stop"),P.current=!1,O(t.run),h.current.stop()),te((function(e){return!e})),ae((function(e){return!e})))}),[L,t]),Object(j.useTick)((function(){if(w.x<=-k.current.width)return X&&Y(!X),H({type:"UPDATE_COUNT",value:B+1}),y((function(e){return{x:a.width,y:e.y}}));var e=Math.max(.1,n);return w.x<ie.x/2&&X&&(e=1,q(!1)),y((function(t){return{x:t.x-10*e,y:t.y}}))}),!R&&!ee);var fe=Object(c.useCallback)((function(e){if(M||W)return!1;H({type:"UPDATE_TOUCH",value:!0}),!J&&X&&Y(!1),U(!1),E(!0),T.current={x:e.data.global.x-w.x,y:e.data.global.y-w.y},O(t.catch),h.current.play()}),[w,M,t,h,H,W,J,X]),he=Object(c.useCallback)((function(e){if(!P.current)return!1;y({x:w.x,y:e}),U(!1),h.current.play()}),[w]),xe=Object(c.useCallback)((function(e){if(!R||M)return!1;H({type:"UPDATE_TOUCH",value:!1}),E(!1);var n=ie.y;if(O(t.run),h.current.stop(),n-w.y<100)return he(n);Oe.start({from:{y:w.y},to:{y:n},onRest:function(){he(n)},onStart:function(){U(!0)}})}),[R,t,w,Oe,ie,M,he,H]),pe=Object(c.useCallback)((function(e){if(R&&h.current){var t=oe.top,n=oe.left,r=oe.right,c=oe.bottom,a=Math.max(Math.min(r,e.data.global.x-T.current.x),n),u=Math.max(Math.min(c,e.data.global.y-T.current.y),t);y({x:a,y:u})}}),[R,oe]);return Object(c.useMemo)((function(){return Object(f.jsx)(f.Fragment,{children:0!==l.length&&Object(f.jsx)(p.AnimatedSprite,Object(s.a)(Object(s.a)({ref:h},k.current),{},{alpha:R?.7:1,interactive:ce,textures:l,isPlaying:!0,initialFrame:0,animationSpeed:n,pointerdown:fe,pointerup:xe,pointerupoutside:xe,pointermove:pe},M?le:w))})}),[R,w,ce,l,M,n,le,fe,pe,xe])},w=function(e){var t="".concat(".","/assets/sprite.json"),n=Object(j.useApp)(),r=Object(c.useRef)(!1),a=Object(c.useState)(null),u=Object(o.a)(a,2),i=u[0],b=u[1],l=new Array(8).fill({speed:.5});return Object(c.useEffect)((function(){r.current||(r.current=!0,n.loader.add(t).load((function(e,n){n[t].data.texture={};var r=n[t].data,c=r.animations,a=r.texture;Object.keys(c).map((function(e){return a[e]=[],c[e].map((function(t){return a[e].push(x.p.from(t))})),!1})),console.log(a),b(n[t].data.texture)})))}),[n.loader,t]),Object(f.jsx)(f.Fragment,{children:i&&Object(f.jsxs)(j.Container,{children:[console.log("render animal container"),l.map((function(t,n){var r=t.speed;return Object(f.jsx)(m,Object(s.a)({resource:i,speed:Math.max(Math.min(Math.random()*r,.45),.2),startPos:40*n,run:2===n},e),n)}))]})})},y=function(e){var t=e.size,n=e.startHandler,r=Object(c.useRef)({width:200,height:80,radius:10}),a=Object(c.useContext)(d),u=Object(o.a)(a,2)[1],i=Object(c.useCallback)((function(e){var t=r.current,n=t.width,c=t.height,a=t.radius;e.clear(),e.lineStyle(2,0,1),e.beginFill(16711867,.25),e.drawRoundedRect(0,0,n,c,a),e.endFill()}),[r]);return Object(f.jsxs)(j.Container,{interactive:!0,buttonMode:!0,position:[(t.width-r.current.width)/2,(t.height-r.current.height)/2],pointerdown:function(e){n&&n(),u({type:"UPDATE_START"})},children:[Object(f.jsx)(j.Graphics,{draw:i}),Object(f.jsx)(j.Text,{anchor:{x:.5,y:.5},text:"Start",x:r.current.width/2,y:r.current.height/2,style:{align:"center"}})]})},T=function(){var e=Object(c.useMemo)((function(){return[{align:"center",fontWeight:900,dropShadow:!0,dropShadowAlpha:.6,dropShadowAngle:1,dropShadowBlur:5,wordWrap:!0,fill:["#ff0000"]}]}),[]),t=Object(o.a)(e,1)[0],n=Object(c.useContext)(d),r=Object(o.a)(n,2),a=r[0].startReducers,u=r[1],i=a.isStart,s=a.isRestart,b=Object(c.useState)("0"),l=Object(o.a)(b,2),O=l[0],h=l[1],x=Object(c.useRef)({lastTime:0,endTime:0,time:600,endSeconds:0}),p=Object(c.useState)(!1),g=Object(o.a)(p,2),m=g[0],w=g[1],y=Object(c.useState)(!1),T=Object(o.a)(y,2),v=T[0],S=T[1],R=Object(c.useCallback)((function(e){var t=Math.floor(e/60%60),n=Math.floor(e%60);h("".concat(t<10?"0"+t:t," : ").concat(n<10?"0"+n:n))}),[]);Object(c.useEffect)((function(){m&&(console.log("restart"),S(!0),w(!1),x.current.time=600,R(x.current.time))}),[s,R]),Object(c.useEffect)((function(){i&&(console.log("start"),S((function(e){return!e})))}),[i]),Object(c.useEffect)((function(){console.log("set time"),R(x.current.time)}),[R]);var E=Object(c.useCallback)((function(){x.current.endSeconds=x.current.time--,x.current.endSeconds<=0?(w(!0),h("00 : 00"),u({type:"UPDATE_GAME_OVER"})):(x.current.endTime=x.current.endSeconds,R(x.current.endTime))}),[x,u,R]);return Object(j.useTick)((function(e){Date.now()-x.current.lastTime>=1e3&&(E(),x.current.lastTime=Date.now())}),!m&&v),Object(c.useMemo)((function(){return Object(f.jsx)(f.Fragment,{children:Object(f.jsx)(j.Text,{text:O,x:100,y:150,style:t})})}),[O,t])},v=function(e){var t=e.size,n=e.endHandler,r=Object(c.useRef)({width:200,height:80,radius:10}),a=Object(c.useContext)(d),u=Object(o.a)(a,2),i=u[0].startReducers,s=u[1],b=i.isGameOver,l=Object(c.useCallback)((function(e){n&&n(),s({type:"UPDATE_GAME_OVER"}),s({type:"UPDATE_RESTART"}),s({type:"UPDATE_COUNT",value:0})}),[s,n]),O=Object(c.useCallback)((function(e){var t=r.current,n=t.width,c=t.height,a=t.radius;e.clear(),e.lineStyle(2,0,1),e.beginFill(16711867,.25),e.drawRoundedRect(0,0,n,c,a),e.endFill()}),[r]);return Object(c.useMemo)((function(){return Object(f.jsx)(f.Fragment,{children:b&&Object(f.jsxs)(j.Container,{interactive:!0,buttonMode:!0,position:[(t.width-r.current.width)/2,(t.height-r.current.height)/2],pointerdown:l,children:[Object(f.jsx)(j.Graphics,{draw:O}),Object(f.jsx)(j.Text,{anchor:{x:.5,y:.5},text:"End",x:r.current.width/2,y:r.current.height/2,style:{align:"center"}})]})})}),[t,b,l,O])},S=function(){return{width:window.innerWidth,height:window.innerHeight}},R=function(e){var t=e.children,n=Object(c.useReducer)(O,l);return Object(f.jsx)(d.Provider,{value:n,children:t})},E=function(e){var t=e.size,n=Object(c.useCallback)((function(e){var n=t.height-50;e.clear(),e.lineStyle(2,0,1),e.moveTo(0,n),e.lineTo(t.width,n)}),[t]);return console.log("render line"),Object(f.jsx)(j.Graphics,{draw:n})},C=function(){var e=function(){var e=Object(c.useState)(S),t=Object(o.a)(e,2),n=t[0],r=t[1];return Object(c.useEffect)((function(){var e=function(){requestAnimationFrame((function(){r(S())}))};return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[]),n}(),t=Object(c.useState)(!1),n=Object(o.a)(t,2),r=n[0],a=n[1],u=Object(c.useCallback)((function(){a(!0)}),[]),i=Object(c.useCallback)((function(){console.log("end -> restart game")}),[]);return Object(f.jsxs)(f.Fragment,{children:[r?Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)(w,{size:e}),Object(f.jsx)(E,{size:e})]}):Object(f.jsx)(y,{size:e,startHandler:u}),Object(f.jsx)(v,{size:e,endHandler:i})]})},A=function(){return Object(f.jsx)(f.Fragment,{children:Object(f.jsx)(j.Stage,Object(s.a)(Object(s.a)({},S()),{},{options:{backgroundColor:16777215,resizeTo:window},children:Object(f.jsxs)(R,{children:[Object(f.jsx)(C,{}),Object(f.jsx)(h,{}),Object(f.jsx)(T,{})]})}))})},M=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,72)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,u=t.getTTFB;n(e),r(e),c(e),a(e),u(e)}))};i.a.render(Object(f.jsx)(a.a.StrictMode,{children:Object(f.jsx)(A,{})}),document.getElementById("root")),M()}},[[71,1,2]]]);
//# sourceMappingURL=main.3c0da0d3.chunk.js.map